<!DOCTYPE html>
<html>
<head>
  <title>Ijtima Performance Data</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', {'packages':['table']});
    google.charts.setOnLoadCallback(init);

    // Replace with your actual Google Sheet ID and tab name
    let sheetUrl = 'https://docs.google.com/spreadsheets/d/11FCt-Uhffya434cBpGsNyotV1dUrMP_hkpeoLjYisdo/gviz/tq?sheet=Sheet1&headers=1';

    let allData;

    function init() {
      loadData();
    }

    function loadData(cityFilter = '') {
      // Columns Fâ€“O only
      let queryString = "SELECT E, F, G, H, I, J, K, L, M, N, O";

      if (cityFilter) queryString += " WHERE F = '" + cityFilter + "'";

      let query = new google.visualization.Query(sheetUrl + "&tq=" + encodeURIComponent(queryString));
      query.send(handleQueryResponse);
    }

    function handleQueryResponse(response) {
      if (response.isError()) {
        alert('Error: ' + response.getMessage());
        return;
      }
      let data = response.getDataTable();
      allData = data;

      // Rename columns for readability
      data.setColumnLabel(0, "Date");
      data.setColumnLable(1, "City");
      data.setColumnLabel(2, "Number of Participants");
      data.setColumnLabel(3, "Invitation through calls");
      data.setColumnLabel(4, "Intentions before Tilawat");
      data.setColumnLabel(5, "Intentions before Naat");
      data.setColumnLabel(6, "Duration of Bayan (minutes)");
      data.setColumnLabel(7, "Was Madani Halqa Conducted?");
      data.setColumnLabel(8, "Was Sunnahs and Manners taught?");
      data.setColumnLabel(9, "Was Learning/Memorizing Dua conducted?");
      data.setColumnLabel(10, "Was Pious Deed Booklet filled with everyone?");

      let table = new google.visualization.Table(document.getElementById('table_div'));
      table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});

      populateCityFilter(allData);
    }

    function populateCityFilter(data) {
      let cities = new Set();
      for (let i = 0; i < data.getNumberOfRows(); i++) {
        cities.add(data.getValue(i, 0)); // Column F = City
      }

      let citySelect = document.getElementById('cityFilter');
      citySelect.innerHTML = '<option value="">All Cities</option>';
      cities.forEach(c => citySelect.innerHTML += `<option value="${c}">${c}</option>`);
    }

    function applyFilters() {
      let city = document.getElementById('cityFilter').value;
      loadData(city);
    }
  </script>
</head>
<body>
  <h2>Ijtima Performance Data (City Filter)</h2>

  <label for="cityFilter">City:</label>
  <select id="cityFilter" onchange="applyFilters()"></select>

  <div id="table_div"></div>
</body>
</html>
